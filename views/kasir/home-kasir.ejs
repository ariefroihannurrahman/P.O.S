<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <title>P.O.S</title>
  </head>
  <body>
    <div class="container">
      <div class="row mb-5">
        <div class="col-6 mt-5">
            <div class="form-group">
              <div class="row">
                <div class="col-10">
                  <label for="kode-produk">Kode Produk</label>
                  <input type="text" class="form-control" id="kode-produk">
                </div>
                <div class="col-2 mt-4 pt-2">
                  <button type="submit" id="submit-kode" class="btn btn-primary">Cari</button>
                </div>
              </div>
            </div>
          </form>
            <div class="form-group">
              <label for="nama-produk">Nama Produk</label>
              <input type="text" class="form-control" id="nama-produk" disabled>
            </div>
            <div class="form-group">
              <label for="harga-produk">Harga (Rp.)</label>
              <input type="text" class="form-control" id="harga-produk" disabled>
            </div>
            <div class="form-group">
              <label for="kuantitas-produk">Kuantitas</label>
              <input type="text" class="form-control" id="kuantitas-produk">
            </div>
            <div class="form-group">
              <label for="subtotal">Subtotal (Rp.)</label>
              <input type="text" class="form-control" id="subtotal" disabled>
            </div>
            <input type="text" class="form-control" id="id-produk" hidden>
          </form>
        </div>
        <div class="col-6 mt-5">
            <div class="form-group">
              <label for="total">Total (Rp.)</label>
              <input type="text" class="form-control" id="total" disabled>
            </div>
            <div class="form-group">
              <label for="bayar">Bayar</label>
              <input type="text" class="form-control" id="bayar">
            </div>
            <div class="form-group">
              <label for="kembalian">Kembalian (Rp.)</label>
              <input type="text" class="form-control" id="kembalian" disabled>
            </div>
            <div class="button-groups mt-5 text-center">
              <a href="/cari-produk" class="btn btn-primary">Cari Produk</a>
              <button type="button" id="tambah-produk" class="btn btn-primary">Tambah Produk</button>
            </div>
        </div>
      </div>
      <div class="row">
        <div class="col mt-5 mb-5">
            <table class="table text-center">
                <thead>
                    <tr>
                        <th scope="col">No.</th>
                        <!-- <th scope="col">Kode Barang</th> -->
                        <th scope="col">Nama Barang</th>
                        <th scope="col">Harga</th>
                        <th scope="col">Kuantitas</th>
                        <th scope="col">Subtotal</th>
                        <th scope="col">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                      
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
      <div class="col mt-5">
        <a href="/laporan-akhir" class="btn btn-primary float-left">Logout</a>
        <button type="button" id="selesai-transaksi" class="btn btn-primary float-right">Selesai</button>
      </div>
    </div>
    </div>

    

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  
    <script>
      $(document).ready(function(){
        var listproduk=[];
        var total = 0;
        var kembalian = 0;
        var bayar = 0;
        var index = 0;

        var dt = new Date();
        var idp = dt.getSeconds()+ "" + dt.getMilliseconds();
        var idk = 1;
        var todate = dt.getFullYear() + "-" + dt.getMonth() + "-" + dt.getDate();

        $('#submit-kode').click(function(){
          var kode = $('#kode-produk').val();
          $.ajax({
              url:"http://localhost:3000/get-produk-kode",
              method:"POST",
              data:{kode:kode},
              dataType:"JSON",
              success:function(data)
              {
                console.log(data);
                dataproduk = data;
                  $('#nama-produk').val(data.nama_produk);
                  $('#harga-produk').val(data.harga);
                  $('#id-produk').val(data.id_produk);
              }
          });
        });

        $('#kuantitas-produk').change (function(){
          var nama = $('#nama-produk').val();
          var harga = parseInt($('#harga-produk').val());
          var kuantitas = parseInt($('#kuantitas-produk').val());
          var subtotal = kuantitas * harga;
          $('#subtotal').val(subtotal);
        });

        $('#tambah-produk').click(function(){
          var nama = $('#nama-produk').val();
          var harga = parseInt($('#harga-produk').val());
          var kuantitas = parseInt($('#kuantitas-produk').val());
          var id = parseInt($('#id-produk').val());
          var subtotal = kuantitas * harga;
          var getproduk = [id,nama,harga,kuantitas,subtotal];
          // var getproduk = {id,nama,harga,kuantitas,subtotal};
          listproduk.push(getproduk);
          console.log(listproduk);
          $('#kode_produk').val("");
          $('#nama-produk').val("");
          $('#harga-produk').val("");
          $('#id-produk').val("");
          $('#kuantitas-produk').val("");
          $('#subtotal').val("");

          // $('tbody').append('<tr><td>'+listproduk.length+'</td><td id="nama_produk">'+nama+'</td><td id="harga_produk">'+harga+'</td><td id="kuantitas_produk">'+kuantitas+'</td><td id="subtotal_produk">'+subtotal+'</td><td id="id_produk" hidden>'+id+'</td><td id="id_produk"><button type="button" class="btn btn-primary">Delete</button></td></tr>')

          $.ajax({
              url:"http://localhost:3000/save-item",
              method:"POST",
              data: {
                id_transaksi :idp,
                id_produk : id,
                kuantitas : kuantitas,
                subtotal : subtotal
              },
              dataType:"JSON",
              success:function(data)
              {

              }
          });

          $.ajax({
              url:"http://localhost:3000/get-item-list",
              method:"POST",
              data: {
                id_transaksi :idp,
              },
              dataType:"JSON",
              success:function(data)
              {          
                $('tbody').append('<tr><td>'+listproduk.length+'</td><td id="nama_produk">'+data[index].nama_produk+'</td><td id="harga_produk">'+data[index].harga+'</td><td id="kuantitas_produk">'+data[index].kuantitas+'</td><td id="subtotal_produk">'+data[index].subtotal+'</td><td><a href="/delete-item/'+data[index].id_detail+'" type="submit" class="btn btn-danger">Delete</a></td></tr>')
                index += 1;
              }
          });



          total += subtotal;
          $('#total').val(total);
        });

        $('#bayar').change (function(){
          bayar = parseInt($('#bayar').val());
          if(bayar < total){
            alert("Uang Kurang");
          }else{
            kembalian = bayar - total;
            $('#kembalian').val(kembalian);
          }
        });

        $('#selesai-transaksi').click(function(){
          $.ajax({
              url:"http://localhost:3000/save-penjualan",
              method:"POST",
              data: {
                id_penjualan : idp,
                id_karyawan :idk,
                tanggal_penjualan : todate,
                total_transaksi : total,
                kembali : kembalian,
                bayar : bayar
              },
              dataType:"JSON",
              success:function()
              {
                console.log("Data Berhasil Dikirim")
              }
          });

          


          // $.ajax({
          //     url:"http://localhost:3000/transaksi/save",
          //     method:"POST",
          //     data: JSON.stringify(listproduk),
          //     dataType:"JSON",
          //     success:function()
          //     {
          //       console.log("Data Berhasil Dikirim")
          //     }
          // });
        });
      });
    </script>
  </body>
</html>